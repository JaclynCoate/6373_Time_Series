---
title: "Project: US Data EDA"
author: "Jaclyn Coate & Josh Eysenbach"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(skimr)

```

# US COVID Data

## EDA 

### US Covid Data
We leveraged the [The Covid Tracking Project](https://covidtracking.com/) for analyzing the COVID impact on the United States. The COVID Tracking Project is being utilized by many leading and trusted groups such as  the CDC, HHS, and Johns Hopkins.

Using the simple read.csv command we load the data from our [Data](https://github.com/JaclynCoate/6373_Time_Series/tree/master/TermProject/Data) folder for our [Term Project](https://github.com/JaclynCoate/6373_Time_Series/tree/master/TermProject) Github repository.

```{r load data}
us <- read.csv("https://raw.githubusercontent.com/JaclynCoate/6373_Time_Series/master/TermProject/Data/USdaily7.19.csv", header = T, strip.white = T)
str(us)
```

### Variable Evaluation and Formatting

```{r}
us <- transform(us, date = as.Date(as.character(date), "%Y%m%d"))
head(us)
```

### Logical Variable Removal
During this project we will be trying to surface those metrics that properly evaluate the severity of COVID in the US. In order to simplify our data set we will remove all variables that do not directly link to metrics dealing with COVID or variables that are depcitign the same information. E.g. _totalTestResults_ and _postNeg_.

```{r}
us <- subset(us, select = -c(states, dateChecked, lastModified, posNeg, hash))
head(us)
```

### NA Evaluation

Upon evaluating the columns that contain not available information, we can see in the early dates of data collection the US had a low count of COVID cases. Since it is likely that those metrics were actually zero since they weren't even being collected at that time, we will repalce all NAs with zeros.

```{r}
us[is.na(us)] <- 0
tail(us)
```

### Zero variance variable check
All variables show a variance therefore we will keep all in the model for now

```{r zero variable check}
skim(us)
```

## Variable Review
Below we will use a basic lines graph by day to see the general trend of some of the basic cumulative variables that are provided by our raw data set. The cumulative variables are interesting to see the general trend of the data. 

### Cumulative COVID Cases in US
We can see that the total cumulative COVID cases are increasing overtime with what appears to be no reprieve.

```{r}
library(ggplot2)
library(ggthemes)

ggplot(data = us, aes(x=date, y=positive))+
  geom_line(color="gold")+
  labs(title = "Cumulative COVID Cases US", y = "Millions", x = "") +
  theme_hc()
```

### Cumulative COVID Hospitalized Cases in US
The total hospitilizations due to covid appear to also increase over time. We do see a little more movement in this graph, however, overall clearly increasing.

```{r}
ggplot(data = us, aes(x=date, y=hospitalizedCumulative))+
  geom_line(color="orange")+
  labs(title = "Cumulative COVID Hospitalized Cases US", y = "Millions", x = "") +
  theme_hc()
```

### Cumulative COVID Related Deaths in US
The cumulative deaths are also increasing over time. We can clearly see what appears to be an upward trend.

```{r}
ggplot(data = us, aes(x=date, y=death))+
  geom_line(color="dark red")+
  labs(title = "Cumulative COVID Death Cases US", y = "Millions", x = "") +
  theme_hc()
```

### New Confirmed COVID in US
When we start to investigate at a more micro level and review something like the daily new cases we see more trending behavior and something that can be more properly evaluated.
Newly confirmed cases have a little more inforamtion to tell use from a trend perspective. We can see some pseudo-cyclic behavior alongside some heavy wandering behavior.

```{r}
ggplot(data = us, aes(x=date, y=positiveIncrease))+
  geom_line(color="gold")+
  labs(title = "New COVID Cases US", y = "Thousands", x = "") +
  theme_hc()
```

### New COVID Hospitalizations in US
Again, looking at a more micro view of just new hospitalizations shows us much more behavior that we might be able to evaluate moving forward. Below we can see what appears to be some pseudoc-cyclic behavior that appears stationary. No major wandering behavior. 

```{r}
ggplot(data = us, aes(x=date, y=hospitalizedIncrease))+
  geom_line(color="orange")+
  labs(title = "New COVID Hospitalized Cases US", y = "Thousands", x = "") +
  theme_hc()
```

### New COVID Deaths in US
When we review the new death cumulative count we can see what again appears to be a pseudo-cyclic behavior with maybe some slight wandering tendencies.

```{r}
ggplot(data = us, aes(x=date, y=deathIncrease))+
  geom_line(color="dark red")+
  labs(title = "New COVID Death Cases US", y = "Thousands", x = "") +
  theme_hc()
```

## Caculated Variables Creation & Review
In order to review the data in 

### Daily Positivity Rate
When reviewing the daily positivty rate, the metric discussed that is more reported on lately. We see the positivity rate actually decreasing over time. We would expect this outcome since we saw a drastic increase in testing over time as well.

```{r}
us$posRate <- us$positiveIncrease / us$totalTestResults

ggplot(data = us, aes(x=date, y=posRate))+
  geom_line(color="gold")+
  labs(title = "Daily Positivity Rate COVID Testing US", y = "Rate", x = "") +
  theme_hc()
```

### Hospitalization Rate
When reviewing rates we also chose to observe the trend of the hospitalization rate of positively tested COVID patients. We see the hospitalization rate start very low then spike to around 15%. The hospitilization rate seems to hover in the low teens for a few months and then it appears to beging to decrease.

```{r}
us$hospRate <- us$hospitalizedCumulative / us$positive

ggplot(data = us, aes(x=date, y=hospRate))+
  geom_line(color="dark orange")+
  labs(title = "Daily Hospitalization Rate COVID Testing US", y = "Rate", x = "") +
  theme_hc()
```

### Death Rate
Like the previous rates we have examined before we see an initial spike in death rate and what appears to be drop off as quickly on the rate of death itself. When we see the death rate hovering right under 4% we should also nte that the flu death rate is about 1%. That puts COVID about 3 times as deadly as the flu.

```{r}
us$deathRate <- us$death / us$positive

ggplot(data = us, aes(x=date, y=deathRate))+
  geom_line(color="dark red")+
  labs(title = "Daily Death Rate COVID Testing US", y = "Rate", x = "") +
  theme_hc()
```

### Recovery Rate
In an opposite pattern of the previous rates we have evaluted we actually see a sharp increase in recovyer rate over time. It appears to be plateauing recently, but what we would expect is for it to continue to increase and provide a final percent of infected individuals who have recovered from COVID.

```{r}
us$recRate <- us$recovered / us$positive

ggplot(data = us, aes(x=date, y=recRate))+
  geom_line(color="dark green")+
  labs(title = "Daily Recovery Rate COVID Testing US", y = "Rate", x = "") +
  theme_hc()
```








#Highcharter Efforts
```{r}
#library(highcharter)


#time series
#hchart(usCum$total)

#multivariate time series
#x <- cbind(mdeaths, fdeaths)
#hchart(x)

#library("forecast")

#x <- forecast(ets(USAccDeaths), h = 48, level = 95)
#hchart(x)

#economics_long2 <- economics_long %>% 
#  filter(variable %in% c("pop", "uempmed", "unemploy")) %>% 
#  print()

#hchart(economics_long2, "line", hcaes(x = date, y = value01, group = variable))
```

HighCharter Graphs Example
- http://jkunst.com/highcharter/index.html

```{r Scatter plot of IBU vs ABV By Region}
#glimpse(brew.beerABVper)
#hchart(brew.beerABVper, "scatter", hcaes(x = IBU, y = ABVper, group = Region)) %>%
#  hc_legend(enabled = FALSE) %>%
#  hc_title(text = "Bitterness (IBU) vs. Alcoholic Content (IBU)")
```
